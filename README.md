# Manga Translator

## Описание

Проект автоматического перевода манги с нескольких языков. Данная система обнаруживает пузыри, распознаёт на них текст, переводит его и вставляет обратно в изображение, используя выбранным пользователем шрифт.

### Технологии

| Компонент | Технология | Назначение |
|-----------|------------|------------|
| **Управление проектом** | pydantic-settings | Конфигурация и настройки |
| **Детекция пузырей** | YOLOv8 | Обнаружение пузырей с текстом |
| **Распознавание текста** | [Manga OCR](https://github.com/kha-white/manga-ocr)/ [docTR](https://github.com/mindee/doctr) / [PaddleOCR](https://github.com/PaddlePaddle/PaddleOCR) / [EasyOCR](https://github.com/JaidedAI/EasyOCR) |  OCR |
| **Перевод** | Google / Transformers (Helsinki-NLP) | Перевод текста |
| **Веб-интерфейс** | [Streamlit](https://github.com/streamlit/streamlit) | UI интерфейс |


### Особенности работы и интерфейса

* После запуска окроется вкладка в браузере, где можно будет представлен интерфейс взаимодействия. В настройках можно будет выбрать язык оригинальнала, тип модели OCR, шрифт (и посмотреть как он выглядит с помощью предпросмотра) и переводчика (с помощью google или transformers моделей).

* После выбора настроек небходимо нажать на кнопку "Инициализировать пайплайн". Это позволит установить необходимые модели, в соответсвии с выбором пользователя. После этого можно будет загружать фотографии и переводить.

* Язык оригинала можно выбрать "ja" - японский, "en" - английский, "auto" - выберет сам из доступных.

* В качество OCR можно выбрать из: Manga OCR, docTR, PaddleOCR, EasyOCR. Для японского лучше выбирать "manga", для английского "doctr" или "paddle".

* В качетсве переводчика можно выбрать: "google" или "transformers" (модели, которые будут дополнительно подгружены).

* Возможен перевод как одного изображения, так и сразу пакета изображений. Отмечу, что при переводе одного изображения есть возможность не удалять сообщения после перевода (все будет оставаться в директориях `./data/in` и `./data/out`). При пакетной все изображения обработаются и можно будет сказать в едином `.zip` файле.

* В директории `./data/fonts` можно найти некоторые шрифты, которые были загружены со следующих сайтов: [arial](https://github.com/matomo-org/travis-scripts/blob/master/fonts/Arial.ttf), [ccfacefront](https://a-comics.ru/forum/index.php?showtopic=76), [deathrattlebb](https://a-comics.ru/forum/index.php?showtopic=76), [manga](https://fonts-online.ru/fonts/mp-manga). Возможно добавление других шрифтов, необходимо будет просто загрузить свой шрифт в директорию к остальным и выбрать его через интерфейс.

### Демонстрация работы

В данном ролике можно увидеть демонстрацию работы системы.

https://github.com/user-attachments/assets/99bc66c3-16c1-4131-b226-07b03fb9f105

## Установка через `uv`
* Требования:
    - Установленный `uv` на устройстве
    - Python 3.11
* Команды:
```
uv venv
uv sync --no-dev
```
* Активация виртуального окружения
```
source .venv/bin/activate
```

## Запуск
Для запуска использовать команду
```
uv run streamlit run main.py
```

## Docker
* Создание Docker образа
```
docker build -t <image_name>:<tag> .
```
> Докер образ получится довольно большой и потребует времени на сборку (около 10 мин, зависит от соединения).

* Запуск
```
docker run -p 8501:8501 --mount type=bind,source="$(pwd)/data",target=/app/data <image_name>:<tag>
```

> * Открыть браузер и перейти по адресу: [localhost:8501](http://localhost:8501)
> * Подождать некоторое время, пока появится интерфейс.
> * При первом запуске инициализации для текущих настроек (при смене могут подгрузиться другие, далее кэшируются) загрузятся необходимые модели, что займет некоторое время.
